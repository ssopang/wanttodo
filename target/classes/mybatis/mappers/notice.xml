<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "../mybatis-3-mapper.dtd">
   
<mapper namespace="mapper.notice">
 	<resultMap id="noticeResult" type="noticeVO" >
		<result property="rownum" column="rownum"/>
		<result property="level" column="level"/>
		<result property="notice_no" column="notice_no"/>
		<result property="notice_head" column="notice_head"/>
		<result property="notice_title" column="notice_title"/>
		<result property="notice_content" column="notice_content"/>
		<result property="notice_writedate" column="notice_writedate"/>
		<result property="fileName" column="fileName"/>
		<result property="mem_id" column="mem_id"/>
		<result property="views" column="views"/>
	</resultMap> 
	
	
	
	
	<!-- Í≥µÏßÄÏÇ¨Ìï≠ ÏãúÌÄÄÏä§ -->
	<select id="seq_notice_no_currval" resultType="int">
	<![CDATA[
	select seq_notice_no.currval from dual
	]]>
	</select>
	
	<select id="seq_notice_no_nextval" resultType="int">
	<![CDATA[
	select seq_notice_no.nextval from dual
	]]>
	</select>
	
	
	<!-- Í≥µÏßÄÏÇ¨Ìï≠ ÏãúÌÄÄÏä§ -->
	
	<!-- ÌéòÏù¥Ïßï -->
<!-- ÌéòÏù¥ÏßïÏù¥ Ï†ÅÏö©Îêú Í≤ÄÏÉâ Í∏∞Îä• -->
<!-- üî• Í≤ÄÏÉâÎêú Ï†ÑÏ≤¥ Í≥µÏßÄÏÇ¨Ìï≠ Í∞úÏàòÎßå Î∞òÌôò -->
<select id="countSearchNotices" parameterType="java.util.Map" resultType="int">
    SELECT COUNT(*) FROM C_NOTICE
    WHERE 1=1
    <if test="searchQuery != null and searchQuery != ''">
        <if test="searchType eq 'notice_title'">
            AND REGEXP_LIKE(NOTICE_TITLE, REGEXP_REPLACE(#{searchQuery}, '[„Ñ±-„Öé„Öè-„Ö£]', ''))
        </if>
        <if test="searchType eq 'notice_content'">
            AND REGEXP_LIKE(NOTICE_CONTENT, REGEXP_REPLACE(#{searchQuery}, '[„Ñ±-„Öé„Öè-„Ö£]', ''))
        </if>
        <if test="searchType eq 'both'">
            AND (
                REGEXP_LIKE(NOTICE_TITLE, REGEXP_REPLACE(#{searchQuery}, '[„Ñ±-„Öé„Öè-„Ö£]', '')) 
                OR REGEXP_LIKE(NOTICE_CONTENT, REGEXP_REPLACE(#{searchQuery}, '[„Ñ±-„Öé„Öè-„Ö£]', ''))
            )
        </if>
    </if>
</select>



<select id="searchNoticeLists" parameterType="java.util.Map" resultType="com.myspring.team.notice.vo.NoticeVO">
    SELECT * FROM (
        SELECT ROWNUM AS rn, B.* FROM (
            SELECT * FROM C_NOTICE
            WHERE 1=1
            <if test="searchQuery != null and searchQuery != ''">
                <if test="searchType == 'notice_title'">
                    AND REGEXP_LIKE(NOTICE_TITLE, REGEXP_REPLACE(#{searchQuery}, '[„Ñ±-„Öé„Öè-„Ö£]', ''))
                </if>
                <if test="searchType == 'notice_content'">
                    AND REGEXP_LIKE(NOTICE_CONTENT, REGEXP_REPLACE(#{searchQuery}, '[„Ñ±-„Öé„Öè-„Ö£]', ''))
                </if>
                <if test="searchType == 'both'">
                    AND (REGEXP_LIKE(NOTICE_TITLE, REGEXP_REPLACE(#{searchQuery}, '[„Ñ±-„Öé„Öè-„Ö£]', '')) 
                    OR REGEXP_LIKE(NOTICE_CONTENT, REGEXP_REPLACE(#{searchQuery}, '[„Ñ±-„Öé„Öè-„Ö£]', '')) )
                </if>
            </if>
            ORDER BY NOTICE_NO DESC  <!-- üî• Ï†ïÎ†¨ ÌõÑ ÌéòÏù¥Ïßï Ï†ÅÏö© -->
        ) B
    ) 
    WHERE rn BETWEEN ((#{section} - 1) * 100 + (#{pageNum} - 1) * 10 + 1) 
                  AND ((#{section} - 1) * 100 + #{pageNum} * 10)
</select>




<!-- Ï†ÑÏ≤¥ Í≥µÏßÄÏÇ¨Ìï≠ Í∞úÏàò Í∞ÄÏ†∏Ïò§Í∏∞ -->
<select id="selectToNotices" resultType="int">
    <![CDATA[
        SELECT COUNT(NOTICE_NO) FROM C_NOTICE
    ]]>
</select>



	<select id="selectAllNoticesList" parameterType="java.util.Map" resultMap="noticeResult">
		<![CDATA[
SELECT * FROM (
    SELECT 
        ROWNUM AS rn,
        notice_no,
        notice_head,
        notice_title,
        notice_content,
        notice_writedate,
        fileName,
        mem_id,
        views
    FROM (
        SELECT * FROM C_NOTICE 
        ORDER BY notice_writedate DESC  -- ÏµúÏã†Í∏Ä Ï†ïÎ†¨ ÌõÑ ROWNUM Ï†ÅÏö©
    )
    WHERE ROWNUM <= #{section} * 100  -- ÏÑπÏÖòÎ≥Ñ ÏµúÎåÄ 100Í∞ú Í∞ÄÏ†∏Ïò§Í∏∞
) 
WHERE rn BETWEEN ((#{section} - 1) * 100 + (#{pageNum} - 1) * 10 + 1) 
              AND ((#{section} - 1) * 100 + #{pageNum} * 10)
		]]>
</select>

	
	

	<select id="selectNotice" resultMap="noticeResult">
    <![CDATA[
		select *
		from c_notice
		where notice_no = #{notice_no}	
    ]]>
	</select>


<!-- „Öá„Öá-->

<!-- Í≥µÏßÄÏÇ¨Ìï≠ Î≤àÌò∏ ÎØ∏Î¶¨ ÏÉùÏÑ± -->
<select id="selectNewNoticeNO" resultType="int">
    <![CDATA[
        SELECT SEQ_NOTICE_NO.NEXTVAL FROM DUAL
    ]]>
</select>

<!-- Í≥µÏßÄÏÇ¨Ìï≠ Ï∂îÍ∞Ä -->
<insert id="addNotice" parameterType="java.util.Map">
    INSERT INTO C_NOTICE (NOTICE_NO, NOTICE_HEAD, NOTICE_TITLE, NOTICE_CONTENT, FILENAME, MEM_ID)
    VALUES (#{notice_no}, #{notice_head}, #{notice_title}, #{notice_content}, 
            #{fileName, jdbcType=VARCHAR}, #{mem_id})
</insert>


<!-- Í≥µÏßÄÏÇ¨Ìï≠ ÌååÏùº ÏóÖÎç∞Ïù¥Ìä∏ -->
<update id="updateNoticeFile" parameterType="noticeVO">
    <![CDATA[
    UPDATE C_NOTICE
    SET FILENAME = #{fileName}
    WHERE NOTICE_NO = #{notice_no}
    ]]>
</update>

<delete id="deleteNotice" parameterType="int">
 <![CDATA[
    DELETE FROM C_NOTICE WHERE NOTICE_NO = #{notice_no}
     ]]>
</delete>

<update id="updateNotice" parameterType="java.util.Map">
 <![CDATA[
    UPDATE C_NOTICE 
    SET NOTICE_HEAD = #{notice_head}, 
        NOTICE_TITLE = #{notice_title}, 
        NOTICE_CONTENT = #{notice_content}, 
        fileName = #{fileName, jdbcType=VARCHAR}
    WHERE NOTICE_NO = #{notice_no}
     ]]>
</update>

<update id="updateViews" parameterType="int">
		<![CDATA[
		update c_notice
		set views = views+1
		where notice_no = #{notice_no}
		]]>
	</update>

</mapper>
